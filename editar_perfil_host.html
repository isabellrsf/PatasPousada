<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Perfil do Anfitrião — Patas Pousada</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Nunito:wght@200..1000&family=Parkinsans:wght@300..800&display=swap');

:root{
  --brand:#e2725b;
  --brand-strong:#d45f47;
  --ink:#1f2937;
  --muted:#6b7280;
  --bg:#f3f4f6;
  --white:#fff;
  --radius:12px;
  --shadow:0 4px 12px rgba(0,0,0,.06);
  --line:#e5e7eb;
  --transition:.2s cubic-bezier(.25,.8,.25,1);
}

*{margin:0;padding:0;box-sizing:border-box}
html,body{max-width:100%;overflow-x:hidden}
body{
  font-family:'Nunito',sans-serif;
  background:var(--bg);
  color:var(--ink);
  line-height:1.5;
}
a{text-decoration:none;color:inherit}
button{font-family:inherit}
:focus-visible{outline:3px solid rgba(226,114,91,.35); outline-offset:2px}

/* HEADER */
header{
  display:flex;
  justify-content:center;
  background:rgba(255,255,255,.95);
  box-shadow:0 1px 3px rgba(0,0,0,.05);
  position:sticky;
  top:0;
  z-index:100;
  backdrop-filter: blur(8px);
}
nav{
  max-width:1100px;
  width:100%;
  padding:16px 24px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:16px;
}
.logo{
  display:flex;
  align-items:center;
  gap:10px;
  font-family:Parkinsans,sans-serif;
  font-weight:800;
  font-size:1.35rem;
  color:var(--brand);
  flex: 0 0 auto;
}
.logo img{width:34px;height:34px}

/* Links (desktop) */
.nav-links{
  list-style:none;
  display:flex;
  align-items:center;
  gap:22px;
}
.nav-links a{
  font-family:Parkinsans,sans-serif;
  font-weight:700;
  color:#4b5563;
}
.nav-links a:hover{color:var(--brand)}

/* Hamburger (mobile) */
.menu-toggle{
  display:none;
  width:44px;
  height:44px;
  border-radius:14px;
  border:1px solid var(--line);
  background:#fff;
  color:#4b5563;
  cursor:pointer;
  align-items:center;
  justify-content:center;
  box-shadow:0 2px 8px rgba(0,0,0,.05);
  transition: transform var(--transition), box-shadow var(--transition), border-color var(--transition), color var(--transition);
  -webkit-tap-highlight-color: transparent;
}
.menu-toggle:hover{
  border-color: rgba(226,114,91,.35);
  color: var(--brand-strong);
  box-shadow:0 8px 20px rgba(0,0,0,.08);
  transform: translateY(-1px);
}
.menu-toggle:active{ transform: translateY(0); }

/* User menu (top) */
.user-menu{
  display:flex;
  align-items:center;
  gap:10px;
  flex: 0 0 auto;
}
.user-menu img{
  width:40px;height:40px;border-radius:50%;
  object-fit:cover;background:#eee;
  border:1px solid var(--line);
}
.user-menu span{font-weight:800; max-width:150px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
.user-menu a{font-weight:800;color:#4b5563}
.user-menu a:hover{color:var(--brand)}

/* Mobile menu overlay */
.mobile-menu{
  position: fixed;
  inset: 0;
  background: rgba(17,24,39,.35);
  display: none;
  z-index: 999;
  backdrop-filter: blur(3px);
}
.mobile-menu.is-open{ display:block; }

.mobile-menu__panel{
  position:absolute;
  top: 72px;
  right: 12px;
  left: 12px;
  background:#fff;
  border:1px solid var(--line);
  border-radius:16px;
  box-shadow:0 16px 50px rgba(0,0,0,.16);
  overflow:hidden;
}

.mobile-menu__links{
  display:flex;
  flex-direction:column;
  padding:10px;
  gap:6px;
}
.mobile-menu__links a{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding:12px 12px;
  border-radius:14px;
  font-family:Parkinsans,sans-serif;
  font-weight:800;
  color:#374151;
  background:#fff;
  transition: background var(--transition), color var(--transition), transform var(--transition);
}
.mobile-menu__links a i{ color:#9ca3af; }
.mobile-menu__links a:hover{
  background:#fff7f5;
  color: var(--brand-strong);
  transform: translateX(2px);
}
.mobile-menu__foot{
  border-top:1px solid var(--line);
  padding:10px;
  display:flex;
  justify-content:flex-end;
  gap:10px;
}
.mobile-menu__close{
  border:1px solid var(--line);
  background:#fff;
  border-radius:12px;
  padding:10px 12px;
  cursor:pointer;
  font-weight:900;
  color:#6b7280;
}
.mobile-menu__close:hover{ color: var(--brand-strong); border-color: rgba(226,114,91,.35); }

/* CONTAINER */
.container{
  max-width:800px;
  margin:32px auto;
  padding:0 20px;
}

/* VOLTAR */
.btn-back{
  display:inline-flex;
  gap:8px;
  align-items:center;
  margin-bottom:24px;
  padding:10px 18px;
  border-radius:999px;
  background:#fff;
  border:1px solid var(--line);
  font-weight:900;
  font-size:.9rem;
  color:var(--muted);
  transition: transform var(--transition), box-shadow var(--transition), border-color var(--transition), color var(--transition);
  -webkit-tap-highlight-color: transparent;
}
.btn-back:hover{
  border-color:rgba(226,114,91,.35);
  color:var(--brand-strong);
  box-shadow:0 10px 22px rgba(0,0,0,.08);
  transform:translateY(-1px);
}

/* PERFIL */
h2{
  font-family:Parkinsans,sans-serif;
  font-size:1.6rem;
  margin-bottom:6px;
}
.sub{
  color:var(--muted);
  margin-bottom:30px;
}

/* FOTO */
.foto-perfil{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:15px;
  margin-bottom:30px;
  padding-bottom:30px;
  border-bottom:1px solid var(--line);
}
.foto-wrapper{
  position:relative;
  width:104px;height:104px;
  cursor:pointer;
  border-radius:50%;
}
.foto-wrapper img{
  width:100%;height:100%;
  border-radius:50%;
  object-fit:cover;
  border:4px solid #fff;
  box-shadow:0 4px 15px rgba(0,0,0,.1);
  background:#eee;
}
.foto-badge{
  position:absolute;
  bottom:0;right:0;
  background:var(--brand);
  color:#fff;
  width:34px;height:34px;
  border-radius:50%;
  display:grid;
  place-items:center;
  border:3px solid #fff;
}

/* FORM */
.form-row{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:20px;
}
@media(max-width:600px){
  .form-row{grid-template-columns:1fr}
}
.form-group{
  display:flex;
  flex-direction:column;
  gap:6px;
  margin-bottom:20px;
}
label{font-weight:900;font-size:.9rem}
input,select,textarea{
  padding:12px 16px;
  border-radius:12px;
  border:1px solid #d1d5db;
  font-size:.95rem;
  background:#fff;
  transition: border-color var(--transition), box-shadow var(--transition), background var(--transition);
}
input:focus,select:focus,textarea:focus{
  border-color:var(--brand);
  outline:none;
  box-shadow: 0 0 0 4px rgba(226,114,91,.12);
}
input[readonly]{background:#f3f4f6}
textarea{resize:vertical}

button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:999px;
  background:var(--brand);
  color:#fff;
  font-weight:900;
  font-size:1rem;
  cursor:pointer;
  transition: transform var(--transition), box-shadow var(--transition), background var(--transition);
  -webkit-tap-highlight-color: transparent;
}
button:hover{
  background:var(--brand-strong);
  transform: translateY(-1px);
  box-shadow: 0 12px 22px rgba(226,114,91,.18);
}
button:active{ transform: translateY(0); }

.hint{text-align:center;margin-top:12px;font-weight:800}

/* =========================
   MOBILE TUNING
   - Header no mobile: Patas > Usuário > Hambúrguer
   - Reduz itens do header no telefone
   - Usuário mostra só a foto (sem nome)
   - Sem afetar desktop
   ========================= */
@media (max-width: 860px){
  nav{ padding:12px 14px; gap:10px; }

  /* esconde links no topo, ativa hambúrguer */
  .nav-links{ display:none; }
  .menu-toggle{ display:inline-flex; }

  /* ordem: Patas > usuário > hamburger */
  .logo{ order:1; }
  .user-menu{ order:2; }
  .menu-toggle{ order:3; }

  /* compacta logo */
  .logo{ font-size:1.05rem; gap:8px; }
  .logo img{ width:30px; height:30px; }

  /* usuário: só foto e bem compacto */
  .user-menu{
    gap:0;
    padding:0;
    width:44px;
    height:44px;
    border-radius:999px;
    border:1px solid var(--line);
    background:#fff;
    display:flex;
    align-items:center;
    justify-content:center;
    box-shadow:0 2px 8px rgba(0,0,0,.05);
    transition: transform var(--transition), box-shadow var(--transition), border-color var(--transition);
    -webkit-tap-highlight-color: transparent;
  }
  .user-menu:hover{
    border-color: rgba(226,114,91,.35);
    box-shadow:0 8px 20px rgba(0,0,0,.08);
    transform: translateY(-1px);
  }
  .user-menu:active{ transform: translateY(0); }

  .user-menu img{
    width:36px;
    height:36px;
  }
  .user-menu span{ display:none; } /* no mobile: remove nome */
  .user-menu a{ display:none; }    /* no mobile: "Sair" fica no menu hambúrguer */

  .container{
    margin:22px auto;
    padding:0 14px;
  }
  h2{ font-size:1.45rem; }
  .sub{ margin-bottom:18px; }

  .foto-perfil{
    margin-bottom:20px;
    padding-bottom:20px;
  }
}

/* iPhone safe area */
@supports(padding: env(safe-area-inset-top)){
  header{
    padding-left: env(safe-area-inset-left);
    padding-right: env(safe-area-inset-right);
  }
}
</style>
</head>

<body>

<header>
<nav aria-label="Navegação principal">
  <a href="home_host.html" class="logo">
    <img src="https://images.vexels.com/media/users/3/202255/isolated/preview/a095b3fe28f3c9febbf176089e2d7e08-pegada-de-cachorro-com-osso-de-coracao-rosa-plana.png" alt="Patas Pousada">
    <span>Patas Pousada</span>
  </a>

  <!-- Links (desktop) -->
  <ul class="nav-links" aria-label="Links">
    <li><a href="home_host.html">Painel</a></li>
    <li><a href="reservas_host.html">Reservas</a></li>
    <li><a href="ajuda.html">Ajuda</a></li>
  </ul>

  <!-- Botão hambúrguer (mobile) -->
  <button class="menu-toggle" id="menuToggle" type="button" aria-label="Abrir menu" aria-controls="mobileMenu" aria-expanded="false">
    <i class="fa-solid fa-bars"></i>
  </button>

  <div class="user-menu" aria-label="Usuário">
    <img id="avatarTop" alt="Avatar do anfitrião">
    <span id="userTop">Anfitrião</span>
    <a href="#" id="logout">Sair</a>
  </div>
</nav>
</header>

<!-- Menu mobile (overlay) -->
<div class="mobile-menu" id="mobileMenu" aria-hidden="true">
  <div class="mobile-menu__panel" role="dialog" aria-modal="true" aria-label="Menu">
    <div class="mobile-menu__links">
      <a href="home_host.html">
        <span><i class="fa-solid fa-house" style="margin-right:10px"></i> Painel</span>
        <i class="fa-solid fa-chevron-right"></i>
      </a>
      <a href="reservas_host.html">
        <span><i class="fa-solid fa-calendar-check" style="margin-right:10px"></i> Reservas</span>
        <i class="fa-solid fa-chevron-right"></i>
      </a>
      <a href="ajuda.html">
        <span><i class="fa-solid fa-circle-question" style="margin-right:10px"></i> Ajuda</span>
        <i class="fa-solid fa-chevron-right"></i>
      </a>
      <a href="#" id="logoutMobile">
        <span><i class="fa-solid fa-arrow-right-from-bracket" style="margin-right:10px"></i> Sair</span>
        <i class="fa-solid fa-chevron-right"></i>
      </a>
    </div>
    <div class="mobile-menu__foot">
      <button class="mobile-menu__close" id="menuClose" type="button">Fechar</button>
    </div>
  </div>
</div>

<div class="container">

<a href="menu_perfil_host.html" class="btn-back">
  <i class="fa-solid fa-arrow-left"></i>
  Voltar para o menu
</a>

<h2>Perfil do anfitrião</h2>
<p class="sub">Essas informações ficam visíveis para os tutores.</p>

<div class="foto-perfil">
  <label class="foto-wrapper">
    <img id="preview" alt="Pré-visualização da foto de perfil">
    <div class="foto-badge"><i class="fa-solid fa-camera"></i></div>
  </label>
  <input type="file" id="fotoInput" hidden accept="image/*">
</div>

<form id="form-host" autocomplete="on">
  <div class="form-group">
    <label>Nome completo</label>
    <input type="text" name="full_name" required>
  </div>

  <div class="form-group">
    <label>Email</label>
    <input type="email" name="email" readonly>
  </div>

  <div class="form-row">
    <div class="form-group">
      <label>CPF</label>
      <input type="text" name="cpf" readonly>
    </div>
    <div class="form-group">
      <label>Data de nascimento</label>
      <input type="date" name="birth_date">
    </div>
  </div>

  <div class="form-row">
    <div class="form-group">
      <label>Cidade</label>
      <input type="text" name="city">
    </div>
    <div class="form-group">
      <label>Tipo de residência</label>
      <select name="residence_type">
        <option value="">Selecione</option>
        <option>Casa</option>
        <option>Apartamento</option>
        <option>Sítio / Chácara</option>
      </select>
    </div>
  </div>

  <div class="form-group">
    <label>Quantos pets você tem?</label>
    <input type="number" name="pets_count" min="0">
  </div>

  <div class="form-group">
    <label>Sobre você</label>
    <textarea name="about" rows="5"></textarea>
  </div>

  <button type="submit">Salvar perfil</button>
  <div id="hint" class="hint"></div>
</form>

</div>

<script>
const sb = supabase.createClient(
  "https://nwbgzokttjgkipwzfgzc.supabase.co",
  "sb_publishable_wn2dxmpI7gFOx4nLh5oHqg_Qlc4Q0lQ"
);

const formHost  = document.getElementById('form-host');
const avatarTop = document.getElementById('avatarTop');
const preview   = document.getElementById('preview');
const fotoInput = document.getElementById('fotoInput');
const userTop   = document.getElementById('userTop');
const hint      = document.getElementById('hint');
const logoutBtn = document.getElementById('logout');

let currentUser, hostData={}, avatarFile=null;

(async function init(){
  const { data:{ user } } = await sb.auth.getUser();
  if(!user) return location.href="cadastrarouentrar.html";
  currentUser=user;
  await loadHost();
})();

async function loadHost(){
  const { data, error } = await sb
    .from('hosts')
    .select('*')
    .eq('id', currentUser.id)
    .maybeSingle();

  if(error){ console.error(error); return; }

  hostData = data || {};

  formHost.full_name.value = hostData.full_name || '';
  formHost.email.value     = hostData.email || currentUser.email;
  formHost.cpf.value       = hostData.cpf || '';
  formHost.birth_date.value= hostData.birth_date || '';
  formHost.city.value      = hostData.city || '';
  formHost.residence_type.value = hostData.residence_type || '';
  formHost.pets_count.value= hostData.pets_count ?? '';
  formHost.about.value     = hostData.about || '';

  userTop.textContent = hostData.full_name || 'Anfitrião';

  if(hostData.avatar_url){
    const url = hostData.avatar_url + '?t=' + Date.now();
    avatarTop.src = url;
    preview.src = url;
  }else{
    avatarTop.src = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80'%3E%3Crect width='100%25' height='100%25' rx='40' ry='40' fill='%23eee'/%3E%3Ctext x='50%25' y='56%25' text-anchor='middle' font-size='28' fill='%239ca3af' font-family='Arial'%3EH%3C/text%3E%3C/svg%3E";
    preview.src = avatarTop.src;
  }
}

fotoInput.onchange = e=>{
  avatarFile = e.target.files[0];
  if(avatarFile) preview.src = URL.createObjectURL(avatarFile);
};

formHost.onsubmit = async e=>{
  e.preventDefault();

  let avatarUrl = hostData.avatar_url;

  if(avatarFile){
    const path = `${currentUser.id}/avatar.png`;
    await sb.storage
      .from('host-avatars')
      .upload(path, avatarFile, { upsert:true });

    avatarUrl = sb.storage
      .from('host-avatars')
      .getPublicUrl(path).data.publicUrl;
  }

  const { error } = await sb.from('hosts').upsert({
    id: currentUser.id,
    full_name: formHost.full_name.value,
    email: currentUser.email,
    birth_date: formHost.birth_date.value || null,
    city: formHost.city.value,
    residence_type: formHost.residence_type.value,
    pets_count: formHost.pets_count.value === "" ? null : Number(formHost.pets_count.value),
    about: formHost.about.value,
    avatar_url: avatarUrl
  });

  hint.textContent = error ? 'Erro ao salvar.' : 'Perfil atualizado com sucesso.';
};

/* Logout (desktop) */
logoutBtn.onclick = async (e)=>{
  e.preventDefault();
  await sb.auth.signOut();
  location.href="cadastrarouentrar.html";
};

/* Logout (mobile menu) */
const logoutMobile = document.getElementById('logoutMobile');
logoutMobile.addEventListener('click', async (e)=>{
  e.preventDefault();
  await sb.auth.signOut();
  location.href="cadastrarouentrar.html";
});

/* =========================
   MENU HAMBÚRGUER (mobile)
   ========================= */
const menuToggle = document.getElementById('menuToggle');
const mobileMenu = document.getElementById('mobileMenu');
const menuClose = document.getElementById('menuClose');

function openMenu(){
  mobileMenu.classList.add('is-open');
  mobileMenu.setAttribute('aria-hidden','false');
  menuToggle.setAttribute('aria-expanded','true');
  document.body.style.overflow = 'hidden';
}
function closeMenu(){
  mobileMenu.classList.remove('is-open');
  mobileMenu.setAttribute('aria-hidden','true');
  menuToggle.setAttribute('aria-expanded','false');
  document.body.style.overflow = '';
}

menuToggle.addEventListener('click', ()=>{
  if(mobileMenu.classList.contains('is-open')) closeMenu();
  else openMenu();
});
menuClose.addEventListener('click', closeMenu);

/* fecha ao clicar fora do painel */
mobileMenu.addEventListener('click', (e)=>{
  if(e.target === mobileMenu) closeMenu();
});

/* fecha com ESC */
document.addEventListener('keydown', (e)=>{
  if(e.key === 'Escape' && mobileMenu.classList.contains('is-open')) closeMenu();
});
</script>

</body>
</html>
